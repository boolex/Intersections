<!DOCTYPE HTML>
<html>

<head>
	<title>Hist</title>
	<link rel="icon" type="image/png" href="favicon.png" />
	<script type="text/javascript" src="scripts/app.js"></script>

	<script type="text/javascript" src="scripts/framework/File.js"></script>
	<script type="text/javascript" src="scripts/framework/Event.js"></script>
	<script type="text/javascript" src="scripts/framework/DateExtensions.js"></script>
	<script type="text/javascript" src="scripts/framework/ArrayExtensions.js"></script>
	<script type="text/javascript" src="scripts/framework/EventCollection.js"></script>
	<script type="text/javascript" src="scripts/framework/Intersection/Intersection.js"></script>
	<script type="text/javascript" src="scripts/framework/Intersection/IntersectionSet.js"></script>
	<script type="text/javascript" src="scripts/framework/Intersection/EventIntersection.js"></script>

	<script type="text/javascript" src="scripts/Calculation/TotalTime.js"></script>
	<script type="text/javascript" src="scripts/Calculation/ShedTime.js"></script>
	<script type="text/javascript" src="scripts/Calculation/PlanTime.js"></script>
	<script type="text/javascript" src="scripts/Calculation/ProductionTime.js"></script>
	<script type="text/javascript" src="scripts/Calculation/ProductionTimeWithinOrders.js"></script>
	<script type="text/javascript" src="scripts/Calculation/Availability.js"></script>
	<script type="text/javascript" src="scripts/Calculation/TotalProducedAmountOnOrder.js"></script>
	<script type="text/javascript" src="scripts/Calculation/TotalProducedAmount.js"></script>

	<script type="text/javascript" src="scripts/framework/Sorting/SortedEventCollection.js"></script>
	<script type="text/javascript" src="scripts/framework/Page.js"></script>

	<script type="text/javascript" src="scripts/ProductionHistory/ProductionHistory.js"></script>
	<script type="text/javascript" src="scripts/ProductionHistory/ProductionHistoryWithinPeriod.js"></script>
	<script type="text/javascript" src="scripts/ProductionHistory/FilteredProducitonHistoryWithinPeriodWithIntersections.js"></script>
	<script type="text/javascript" src="scripts/Windows/Header/HeaderPanel.js"></script>

	<script type="text/javascript" src="scripts/framework/Tree/Tree.js"></script>
	<script type="text/javascript" src="scripts/framework/Tree/HtmlTree.js"></script>
	<script type="text/javascript" src="scripts/framework/Tree/SelectableHtmlTree.js"></script>
	<link rel="stylesheet" type="text/css" href="scripts/framework/Tree/style.css">

	<script type="text/javascript" src="scripts/controls/RangePicker/RangePicker.js"></script>
	<script type="text/javascript" src="scripts/controls/RangePicker/RangePickerOnDemand.js"></script>
	<link rel="stylesheet" type="text/css" href="scripts/Controls/RangePicker/style.css">

	<script type="text/javascript" src="scripts/Controls/Timeline/Timeline.js"></script>
	<link rel="stylesheet" type="text/css" href="scripts/Controls/Timeline/style.css">

	<script type="text/javascript" src="scripts/Windows/ProductionStatistics/ProductionStatistics.js"></script>
	<script type="text/javascript" src="scripts/Windows/ProductionStatistics/StatisticsWindow.js"></script>
	<link rel="stylesheet" type="text/css" href="scripts/Windows/ProductionStatistics/style.css">

	<script type="text/javascript" src="scripts/Windows/FileExplorer/FileExplorer.js"></script>
	<script type="text/javascript" src="scripts/Windows/FileExplorer/FileExplorerWindow.js"></script>
	<script type="text/javascript" src="scripts/Filter.js"></script>
	<script type="text/javascript" src="scripts/Database.js"></script>

	<script type="text/javascript" src="scripts/iterators/orderbatchesIterator.js"></script>
	<script type="text/javascript" src="scripts/iterators/ordersIterator.js"></script>
	<script type="text/javascript" src="scripts/iterators/producedUnitsIterator.js"></script>
	<script type="text/javascript" src="scripts/iterators/shiftPeriodsIterator.js"></script>
	<script type="text/javascript" src="scripts/iterators/shiftsIterator.js"></script>
	<script type="text/javascript" src="scripts/iterators/stopsIterator.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="controller.js"></script>
	<script type="text/javascript" src="config.js"></script>

	<script src="lib/vis-4.21.0/vis-4.21.0/dist/vis.js"></script>
	<link href="lib/vis-4.21.0/vis-4.21.0/dist/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
	<script src="lib/jquery/jquery-1.11.0.min.js"></script>
	<script src="lib/anytime/anytime.5.2.0.js"></script>
	<link href="lib/anytime/anytime.5.2.0.css" rel="stylesheet" type="text/css" />

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
</head>

<body>
	<div id="log"></div>
	<div id="header">
		file: 	<div id="fileName"></div>
		now:	<div id="scenario_now"></div>
		<a href="javascript:void(0)" id="download">download</a>
	</div>
	<div id="rangePicker"></div>
	<table style="width:100%">
		<tr>
			<td style="width:200px" rowspan="2">
				<div id="system-structure">

				</div>
			</td>
			<td>
				<table id="factoryDivisionProperties">
					<tbody></tbody>
				</table>
			</td>
		</tr>
		<tr>
			
			<td>
				<div id="visualization"></div>
			</td>
		</tr>
	</table>
	
	<table>
		<tr>
			<td style="vertical-align: top">
			</td>
			<td style="vertical-align: top">
				<div id="statisticsWindow"></div>
			</td>
		</tr>
	</table>
	<table>
		<tr>
			<td style="vertical-align: top">
				<div id="fileExplorer"></div>
			</td>
			<td style="vertical-align: top">
				<div id="groups">
				</div>
			</td>
		</tr>
	</table>
</body>

</html>
<script type="text/javascript">
	window.onload = function () {
		loadApp(config.file);
		registerDownloadClickHandler();
	}
	function registerDownloadClickHandler(){
		document.getElementById('download').addEventListener('click',function(){		
			download(customStringify( window.app.getContextOption('content')));
		});
	}
	function download(data, file) {
    file = file || "production.json";

    if (isIE()) {
        downloadIE(data, file);
    }
    else {
        downloadNotIE(data, file);
    }

}
function isIE() {
    return window.navigator.userAgent.indexOf("MSIE") != -1 || !!window.navigator.userAgent.match(/Trident.*rv\:11\./);
}
function downloadIE(data, file) {
    var c = document.createElement("textarea");
    c.innerHTML = data;
    c.setAttribute("style", "position:absolute;left:0px;top:0px;width:100%;height:100%");
    document.body.appendChild(c);

}
function downloadNotIE(data, file) {
    var a = document.createElement("a");
    a.href = 'data:Application/octet-stream,' + encodeURIComponent(data);
    a.innerHTML = 'Download ' + file;
    a.setAttribute("download", file);
    document.body.appendChild(a);
    a.click();
}
var customStringify = function (v) {
  var cache = new Map();
  return JSON.stringify(v, function (key, value) {
    if (typeof value === 'object' && value !== null) {
      if (cache.get(value)) {
        // Circular reference found, discard key
        return;
      }
      // Store value in our map
      cache.set(value, true);
    }
    return value;
  });
};
</script>